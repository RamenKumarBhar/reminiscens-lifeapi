<!DOCTYPE HTML>
<html>
<head>
<title>Reminiscens</title>
<script src="cordova-2.4.0.js"></script>

<!--<script src="http://code.jquery.com/jquery.js"></script>-->

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="bootstrap/js/bootstrap.js"></script>
<link href="css/StyleOverlay.css" rel="stylesheet">
<script src="js/GestioneOverlay.js"></script>
<link href="kendo/styles/kendo.common.min.css" rel="stylesheet" />
<link href="kendo/styles/kendo.default.min.css" rel="stylesheet" />
<link href="css/StyleRoot.css" rel="stylesheet" />
<script src="kendo/js/kendo.web.min.js"></script>
<script type="text/javascript" src="js/recorder.js"></script>
<script type="text/javascript" src="js/GestioneKendoEditor.js"></script>
<script type="text/javascript" src="js/GestioneFoto.js"></script>
<script type="text/javascript" src="js/GestioneSchermate&Menu.js"></script>
<script type="text/javascript" src="js/GestioneRecorderHTML.js"></script>
<script type="text/javascript" src="js/storage/jquery.storageapi.js"></script>
<script type="text/javascript" src="js/storage/jquery.cookie.js"></script>
<script type="text/javascript" src="js/json/json2.js"></script>
<script type="text/javascript" src="js/GestioneImmagini.js"></script>
<script type="text/javascript" src="js/SaveStoryJSON.js"></script>

<!-- Add mousewheel plugin (this is optional) -->
<script type="text/javascript" src="fancybox/lib/jquery.mousewheel-3.0.6.pack.js"></script>

<!-- Add fancyBox -->
<link rel="stylesheet" href="fancybox/source/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>

<!-- Add jQuery library --><!--<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>-->


<script type="text/javascript" src="js/json/json2.js"></script>
<script type="text/javascript" src="js/sha1.js"></script>


<script>  	
     function onLoad(){
          document.addEventListener("deviceready", onDeviceReady, true);
     }
     function onDeviceReady(){
          //navigator.notification.alert("PhoneGap is working!!");
     }	
	 function editor()
	 {
		var editor = $("#editor").data("kendoEditor");
		//alert(editor.value());
		$("#debug").text(editor.value());
	 }
	 function storage() {
		/*var storage =$.localStorage;
		//alert(storage.get('prova'));
		//var obj = JSON.parse(storage.get('prova'));
		alert(storage.get('prova').titolo);
	 	//$("#debug").text(storage.get('prova'));*/
		
		
		//EliminaIntestazioneDataImg();
		
		//alert();
	 }
	 
	 
	 var tokern;
	 var Storie = [];
	 var MieStorie = [];
	 var NumeroPaginaMieStorie = 0;
	 
	function Login()
	{		
		//var passSha1 = $.sha1($("#password").val());
		var passSha1 = $.sha1("");
		var sessionData = new Object;
		sessionData.name = "reminiscens";
		//sessionData.authString = $("#email").val() + "!_-_!" + passSha1;
		sessionData.authString = "" + "!_-_!" + passSha1; 
		
		var xhr = new XMLHttpRequest();		
		xhr.open('POST', 'http://reminiscens.apiary.io/api/session');		
		xhr.setRequestHeader("Content-Type", "application/json");		
		xhr.onreadystatechange = function () {
  			if (this.readyState == 4) {
    			if (typeof cb !== "undefined") {
					cb(this);
    			}
			}
   			else {
      			//alert('Status: '+this.status+'\nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'\nBody: '+this.		responseText);
				//alert(this.responseText);
				/*var obj = JSON.parse(this.responseText);
				alert(obj.Session.auth_token);*/
    		}
  		};		
		xhr.send("{  \n    \"Service\":{\n        \"name\": \"reminiscens\"\n        \"authString\": \"" + sessionData.authString + "\"  \n    }\n}");
	}
	
	
	function Timeline()
	{
		$.getJSON("http://test.reminiscens.me/lifeapi/person/3/timeline",function(timeline)
		{
			//alert(data.aboutPerson.personId )
				var storyList = timeline.storyList;
				
				var i = 0;
				while(storyList[i] != null)
				{
					//alert(storyList[i].storyId);
					var mementoList = storyList[i].mementoList;
					var j = 0;
					var newStory = new Object;
					newStory.titolo = storyList[i].text;
					newStory.dove = "";
					newStory.quando = storyList[i].startDate.exactDateAsString;
					var vettImm = [];
					while(mementoList[j] != null)
					{						
						if(mementoList[j].category == "PICTURE")
						{
							//alert(mementoList[j].url);
							
							newStory.testo = mementoList[j].headline; //!!!!!da sistemare perchè devo salvare la descizione di ogni immagine!							
							var Imm = new Object;
							Imm.src = mementoList[j].url;
							//alert(Imm.src);s
							vettImm.push(Imm);							
						}						
						j++;
					}
					newStory.immagini = vettImm;
					MieStorie.push(newStory);
					i++;
				}
				
				
				if(MieStorie.length<2) //caso in cui ci sia da stampare solo una foto o nessuna
				{
					stampaMieFoto(0,MieStorie.length);
				}
				else //caso in cui ci siano almeno 2 foto quindi stampo le prime 2
				{
					stampaMieFoto(0,2);
				}
				
				
				
				var storage = $.localStorage;
				storage.set('mieStorie',MieStorie);
				
				
				
				$(".fancybox").fancybox({
					'showCloseButton'	: false,
					afterLoad : function() {
						if(Storie.length>this.index)
						{
    						this.title = "<div><h1>" + Storie[this.index].titolo +"</h1><h5>" + Storie[this.index].testo + "</h5>  </div>";
						}
						else
						{
							this.title = "<div><h1>" + MieStorie[this.index - Storie.length].titolo + "</h1><h5>" + MieStorie[this.index - Storie.length].testo + "</h5>  </div>";
						}
						//this.title = "<div><h1>" + "hola" +"</h1> </div>";
   					},
					'helpers' : { 
    					title : { type : 'inside' }
   					} // helpers
				});
		}
		);
	}
	 
	 
	 function createCORSRequest(method, url){
    var xhr = new XMLHttpRequest();
	
    if ("withCredentials" in xhr){
        xhr.open(method, url, true);
		xhr.onreadystatechange = handler;
		xhr.setRequestHeader("Content-Type", "application/json");
    } else if (typeof XDomainRequest != "undefined"){
        xhr = new XDomainRequest();
        xhr.open(method, url);
		xhr.setRequestHeader("Content-Type", "application/json");
    } else {
        xhr = null;
    }
    return xhr;
}
	 
	 
	 
 
	$(document).ready(function() {					
		
		var jsonObj = new Object;
	
		jsonObj.titolo = "Foto 1";
		jsonObj.dove = "";
		jsonObj.quando = "";
		jsonObj.testo = "2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz...";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.src = "img/comera1.jpg";
		vettImm.push(Imm);
		jsonObj.immagini = vettImm;
		Storie.push(jsonObj);
		
		//alert(Storie[0].titolo);
		
		var jsonObj = new Object;
	
		jsonObj.titolo = "Foto 2";
		jsonObj.dove = "";
		jsonObj.quando = "";
		jsonObj.testo = "09 maggio 1950 - Nasce la comunitÃ  europea...";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.src = "img/comera3.jpg";
		vettImm.push(Imm);
		jsonObj.immagini = vettImm;
		Storie.push(jsonObj);
		
		
		
		var jsonObj = new Object;
	
		jsonObj.titolo = "Foto 3";
		jsonObj.dove = "";
		jsonObj.quando = "";
		jsonObj.testo = "26 gennaio 1950 - L'india diventa una repubblica..";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.src = "img/comera2.jpg";
		vettImm.push(Imm);
		jsonObj.immagini = vettImm;
		Storie.push(jsonObj);
		
		for (i=0; i<Storie.length; i++) { 
			document.getElementById("divFotoDelTempo").innerHTML += "<a class='fancybox' rel='gallery1' href='" + Storie[i].immagini[0].src + "' title='" + Storie[i].titolo + "' > <img src='" + Storie[i].immagini[0].src + "' alt='' /> </a>";
			document.getElementById("divStorieDelTempo").innerHTML += "<div class='immagini'><div class='text'>" + Storie[i].testo +"</div><a class='fancybox' rel='gallery2' href='" + Storie[i].immagini[0].src + "' title='" + Storie[i].titolo + "' > <img src='" + Storie[i].immagini[0].src + "' alt='' /> </a></div>";
		}
		
		
		Login();
		Timeline();
});


function controlloStampaPagine()
{
	if(MieStorie.length>NumeroPaginaMieStorie * 2 + 1) //caso in cui ci siano 2 foto da stampare
	{
		stampaMieFoto(NumeroPaginaMieStorie * 2,NumeroPaginaMieStorie * 2 +2);
	}
	else
	{
			stampaMieFoto(NumeroPaginaMieStorie * 2,NumeroPaginaMieStorie * 2 +1);	
	}
}

function avanti()
{
	NumeroPaginaMieStorie++;
	alert(NumeroPaginaMieStorie);
	if(MieStorie.length <= NumeroPaginaMieStorie * 2){
		NumeroPaginaMieStorie = 0;
	}
	alert(NumeroPaginaMieStorie);
	controlloStampaPagine();
}

function indietro()
{
	NumeroPaginaMieStorie--;
	//alert(NumeroPaginaMieStorie);
	if(NumeroPaginaMieStorie < 0){
		//prendo la metà + eventuale immagine singola (se dim è dispari) - uno perchè le pagine partono da 0!!
		NumeroPaginaMieStorie = Math.floor(MieStorie.length/2) + MieStorie.length%2 - 1;
	}
	//alert(NumeroPaginaMieStorie);
	controlloStampaPagine()
}

function stampaMieFoto(inizio, fine)
{
	//alert(inizio + "  " + fine);
	var i;
	document.getElementById("divMieFotoDelTempo").innerHTML = "";
	document.getElementById("divMieFotoDelTempo").innerHTML += "<button id='indietro' onClick='indietro()'>Indietro</button> <button id='avanti' onClick='avanti()'>Avanti</button></br>";
	for (i=inizio; i<fine; i++) { 
						
		//alert(MieStorie[i].immagini[0].src);
		if(MieStorie[i].immagini[0] != null)
		{
			document.getElementById("divMieFotoDelTempo").innerHTML += "<a class='fancybox' rel='gallery1' href='" + MieStorie[i].immagini[0].src + "' title='" + MieStorie[i].titolo + "' > <img src='" + MieStorie[i].immagini[0].src + "' class='immagini' alt='' /> </a></br>";
		}
		else
		{
			document.getElementById("divMieFotoDelTempo").innerHTML += "<a class='fancybox' rel='gallery1' href='" + "images/no_image.png" + "' title='" + MieStorie[i].titolo + "' > <img src='" + "images/no_image.png" + "' alt='' /> </a></br>";
		}
	}
}
</script>
</head>
<body>
<div id="divRoot">
  <input class="timeline" id="1940" type="image" src="button/1940.jpg">
  <input class="timeline" id="1950" type="image" src="button/1950.jpg">
  <input class="timeline" id="1960" type="image" src="button/1960.jpg">
  <input class="timeline" id="1970" type="image" src="button/1970.jpg">
  <input class="timeline" id="1980" type="image" src="button/1980.jpg">
  <input class="timeline" id="1990" type="image" src="button/1990.jpg">
  <br/>
  <div id="centrale">
    <div id="NoResults" style="display:none;">
      <div style="background-color:#FFF; padding-bottom:30px; padding-top:100px;">
        <label id="lbldebug">Non ci sono ancora storie del 1950!</label>
      </div>
      <button style="margin-top:40px;" class="btn btn-large btn-primary" onClick="ApriOverlay();">Raccontaci una</button>
    </div>
    <div id="Results">
      <div class="navbar">
        <div class="navbar-inner">
          <ul class="nav">
            <li class="active" id="liFoto"><a href="#">Foto</a> </li>
            <li id="liStorie"><a href="#">Storie</a></li>
            <li id="liCanzoni"><a href="#">Canzoni</a></li>
            <li id="liFamosi"><a href="#">Famosi</a></li>
            <li id="liRaccontaci"><a href="#">Raccontaci</a></li>
          </ul>
        </div>
      </div>
      <div id="Foto">
        <div class="divFoto">
          <h3 id="FotoDelTempo">Com'era questo posto attorno al 1950</h3>
          <div id="divFotoDelTempo">          
          <!--<a class="fancybox" rel="gallery1" href="img/comera1.jpg" title="2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz..."> <img src="img/comera1.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/comera3.jpg" title="09 maggio 1950 - Nasce la comunitÃ  europea..."> <img src="img/comera3.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/comera2.jpg" title="26 gennaio 1950 - L'india diventa una repubblica.."> <img src="img/comera2.jpg" alt="" /> </a> -->
          </div>
          </div>
        <div class="divFoto">
          <h3 id="TueFotoDelTempo">Le tue foto attorno al 1950</h3>
          <div id="divMieFotoDelTempo"> 
                  
          <!--<a class="fancybox" rel="gallery1" href="img/tuefoto1.jpg" title="Foto 1"> <img src="img/tuefoto1.jpg" alt=""/> </a> 
          <a class="fancybox" rel="gallery1" href="img/tuefoto2.jpg" title="Foto 2"> <img src="img/tuefoto2.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/tuefoto3.jpg" title="Foto 3"> <img src="img/tuefoto3.jpg" alt="" /> </a>--> </div>
          </div>
      </div>
      <div id="Storie" style="display:none;">
        <div class="divFoto">
          <h3 id="StorieDelTempo">Che cosa succedeva nel 1950</h3>
          <div id="divStorieDelTempo"> 
          </div>
          <!--<div class="immagini">
            <div class="text"> 26 gennaio 1950 - L'india diventa una repubblica </div>
            <img src="img/comera2.jpg" /> </div>
          <div class="immagini">
            <div class="text"> 2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz... </div>
            <img src="img/comera1.jpg" /> </div>
          <div class="immagini">
            <div class="text"> 09 maggio 1950 - Nasce la comunità europea... </div>
            <img src="img/comera3.jpg" /> </div>
-->        </div>
        <div class="divFoto">
          <h3 id="TueStorieDelTempo">Le tue storie nel 1950</h3>
          <!--<img src="img/tuefoto2.jpg" /> </div>-->
          <div id="divMieStorieDelTempo"> 
          </div>
      </div>
    </div>
    <div id="Canzoni" style="display:none;">
      <h1>Quali erano le canzoni pi&uacute; popolari?</h1>
      <div class="divFoto" style="height:500px;">
        <iframe width="420" height="315" src="http://www.youtube.com/embed/CwE8GcoqEfw" frameborder="0" allowfullscreen style="margin-top:30px;"></iframe>
        <h3>Matia Bazar - Cavallo bianco</h3>
      </div>
      <div class="divFoto" style="height:500px;">
        <iframe width="420" height="315" src="http://www.youtube.com/embed/MKahSufwWS0" frameborder="0" allowfullscreen style="margin-top:30px;"></iframe>
        <h3>Patty Pravo - Pensiero Stupendo</h3>
      </div>
    </div>
    <div id="Famosi" style="display:none;">
      <div class="divFoto">
        <h3>Chi &eacute; nato all'epoca</h3>
        <img src="img/Loredana.jpg" class="round"/>
        <h4>Loredana Bert&eacute;</h4>
        <h6>Non &eacute; una signora, &eacute; costantemente</br>
          depressa e in lotta con il </br>
          mondo, difficile da gestire...</h6>
      </div>
      <div class="divFoto">
        <h3>Chi era famoso all'epoca</h3>
        <img src="img/DiPietro.jpg" class="round"/>
        <h4>Antonio di Pietro</h4>
        <h6>Nato il 2 ottobre 1950 a Montenero</br>
          di Bisaccia (CB), &eacute; l'uomo simbolo di</br>
          quella stagione politica che va...</h6>
      </div>
    </div>
  </div>
  <div class="overlay" id="overlay" style="display: none;"></div>
  <!--contenuto overlay-->
  <div id="box">
    <div style="background-color:#D5D5D5; padding-top:10px;">
      <div style="background-color:#A05152; padding-bottom:10px; padding-top:10px;">
        <label>raccontaci la tua storia</label>
        <button id="salva" onClick="salvaStoria();" class="btn btn-primary">Salva</button>
      </div>
      <div style="margin-top:10px; color:#000; margin-left:20px; margin-right:20px;">
        <form>
          <div>
            <label for="titolo" style="float:left; margin-top:3px;">Titolo:</label>
            <input id="titolo" style="float:left; margin-left:31px;" class="input-xxlarge" type="text"/>
          </div>
          <br/>
          <br/>
          <div>
            <label for="quando" style="float:left;margin-top:3px;">Quando:</label>
            <input id="quando" style="float:left; margin-left:3px;" type="text" class="input-xlarge"/>
            <label for="dove" style="float:left;margin-top:3px; margin-left:10px;">Dove:</label>
            <input id="dove" style="float:left; margin-left:3px;" type="text" class="input-xlarge"/>
          </div>
        </form>
      </div>
      <div style="float:left; margin:20px;"> 
        <!--<button onClick="editor();">Editor</button>-->
        <!--<input type="image" src="button/buttonFoto.jpg" onClick="capturePhoto();">-->
        <br/>
        <input id="record" type="image" style="margin-top:10px;" src="button/buttonMicrofono.jpg" onClick="record();">
        <br/>
        <h3 style="color:#FF0;" id="time">0:00</h3>
        <input id="play" type="image" style="margin-top:10px; visibility:hidden;" src="button/buttonPlay.png" onClick="play();">
        <input id="stop" type="image" style="margin-top:10px; margin-left:2px; visibility:hidden;" src="button/buttonStop.png" onClick="stop();">
      </div>
      <textarea  id="editor" rows="10" cols="30" style="width:620px;height:400px; float:left;">
    
    	</textarea>
    </div>
    <img src="images/X.png" class="chiudi" /> </div>
</div>

<!--fine box--> 

<!--<button onClick="storage();">Storage</button>--> 
<!--<label id="debug"></label>-->
<div class="overlay" id="overlayCaricamento" style="display: none;"></div>
<img src="images/caricamento.gif" id="caricamento"/>
</body>
</html>
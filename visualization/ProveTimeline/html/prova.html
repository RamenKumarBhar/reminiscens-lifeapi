<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Prova Timeline</title>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="../lib/jquery-1.6.2.min.js"></script>
	<script type="text/javascript" src="../lib/mxn/mxn.js?(googlev3)"></script>
	<script type="text/javascript" src="../lib/timeline-1.2.js"></script>
	<script src="../src/timemap.js" type="text/javascript"></script>
	<script src="../src/manipulation.js" type="text/javascript"></script>

	<link href="StyleOverlay.css" rel="stylesheet" />
	<script type="text/javascript" src="JavaScriptOverlay.js"></script>

	<!--bootstrap-->
	<link href="../bootstrap/css/bootstrap.css" rel="stylesheet" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
	<script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>
	<style type="text/css">
		#map img {
			max-width: none;
		}
		div.split_sx {
			float: left; /*necessario per l' allineamento dei div in orizzontale*/
			width: 66%;
			overflow-y:auto; /*imposta scrolling*/
			/*overflow-x:hidden;*/
			height:450px;
		}
		div.split_dx {
			float: left; /*necessario per l' allineamento dei div in orizzontale*/
			width: 30%;
			overflow:auto; /*imposta scrolling*/
			height:450px;
		}
	</style>

	<!--overlapping-->
	<script type="text/javascript" src="../lib/oms.min.js"></script>
	<script type="text/javascript">


		var tm;
		$(function () {
			// make a custom map style
			var styledMapType = new google.maps.StyledMapType([
				{
					featureType: "water",
					elementType: "all",
					stylers: [
					  { saturation: 0 },
					  { lightness: 100 }
					]
				},
				{
					featureType: "all",
					elementType: "all",
					stylers: [
					  { saturation: -100 }
					]
				}
			], {
				name: "white"
			});
			//bottone read more nei bubble delle descrizioni
			var ReadMore = "<button id=\"apri\" class=\"btn btn-primary\" onmousedown=\"ApriOverlay()\">Read More...</button>";
			//inizializzazione TimeMap
			tm = TimeMap.init({
				mapId: "map",               // Id of map div element (required)
				timelineId: "timeline",     // Id of timeline div element (required)
				options: {
					eventIconPath: "../images/"
				},
				bandIntervals: "mon", //date nell' ordine di mese/anno
				//yr -> year, decade

				datasets: [
					//Ugo Fantozzi
					{
						id: "Fantozzi",
						title: "Prova",
						// note that the lines below are now the preferred syntax
						type: "basic",
						theme: "red",
						options: {
							items: [

								{
									"start": "1934-07-17",
									//"end": "1934-07-17",
									"point": {
										"lat": 44.43476,
										"lon": 8.944015
									},
									"title": "Nascita Fantozzi",
									"options": {
										theme: new TimeMapTheme({
											icon: "../images/markerIcons/largeTDRedIcons/marker1.png", //marker mappa
											iconSize: [20, 34],
											iconAnchor: [10, 35],
											eventIconImage: "../images/red-circle.png", //immagine timeline
											color: "red" //colore dell' evento
										}),
										// set the full HTML for the info window
										"infoHtml": "Nascita Fantozzi"
									}
								},
								{
									"start": "1960-09-09",
									//"end": "1960-09-09",
									"point": {
										"lat": 46.072397,
										"lon": 11.120882
									},
									"title": "Matrimonio Fantozzi",
									"options": {
										theme: new TimeMapTheme({
											icon: "../images/markerIcons/largeTDRedIcons/marker2.png", //marker mappa
											iconSize: [20, 34],
											iconAnchor: [10, 35],
											eventIconImage: "../images/red-circle.png", //immagine timeline
											color: "red" //colore dell' evento
										}),
										// set the full HTML for the info window
										"infoHtml": "Matrimonio Fantozzi"
									}
								},
								//linea temporale Fantozzi
								{
									start: "1934-07-17",
									end: "1960-09-09",
									polyline: [
										{ lat: 44.43476, lon: 8.944015 },
										{ lat: 46.072397, lon: 11.120882 },
									],
									title: "Vita Fantozzi",
									options: {
										description: "Vita Fantozzi",
										theme: "red",
										// any additional theme settings can go here
										lineWeight: 5
									}
								}
							]
						}
					},
					//Bruno Kessler
					{
						id: "Kessler",
						title: "Prova",
						// note that the lines below are now the preferred syntax
						type: "basic",
						options: {
							items: [
								{
									"start": "1924-02-17",
									//"end": "1924-02-17",
									"point": {
										"lat": 46.363603,
										"lon": 10.672871
									},
									"title": "Nascita Kessler",
									"options": {
										//il tema va applicato nelle options!!!
										theme: new TimeMapTheme({
											icon: "../images/markerIcons/largeTDBlueIcons/marker1.png", //marker mappa
											iconSize: [20, 34],
											iconAnchor: [10, 35], //devo cambiare il punto di ancoraggio dell' icona xk le dimensioni dei nuovi marker sono diverse
											eventIconImage: "../images/blue-circle.png", //immagine timeline
											color: "#5A7ACF" //colore dell' evento
										}),
										// set the full HTML for the info window
										infoHtml: "Nascita Kessler...<br/><br/><img src=\"../images/imgPersonaggi/kesslerNascita.jpg\" /><br/><br/>" + ReadMore
									},

								},
								{
									"start": "1950-01-01",
									"end": "1950-12-31",
									"point": {
										"lat": 45.417612,
										"lon": 11.871836
									},
									"title": "Laurea di Kessler presso Università degli Studi di Padova",
									"options": {
										theme: new TimeMapTheme({
											icon: "../images/markerIcons/largeTDBlueIcons/marker2.png", //marker mappa
											iconSize: [20, 34],
											iconAnchor: [10, 35],
											//eventIconImage: "../images/blue-circle.png", //immagine timeline
											color: "#5A7ACF" //colore dell' evento
										}),
										// set the full HTML for the info window
										//"infoHtml": "Laurea di Kessler presso Università degli Studi di Padova"
										infoHtml: "Laurea di Kessler presso Università degli Studi di Padova...<br/><br/><img src=\"../images/imgPersonaggi/kesslerUni.jpg\" /><br/><br/>" + ReadMore,
									}
								},
								{
									"start": "1956",
									"end": "1976",
									"point": {
										"lat": 46.067827,
										"lon": 11.121014
									},
									"title": "Concilio di Trento con Kessler",
									"options": {
										theme: new TimeMapTheme({
											icon: "../images/markerIcons/largeTDBlueIcons/marker3.png", //marker mappa
											iconSize: [20, 34],
											iconAnchor: [10, 35],
											//eventIconImage: "../images/blue-circle.png", //immagine timeline
											color: "#5A7ACF" //colore dell' evento
										}),
										// set the full HTML for the info window
										//"infoHtml": "Laurea di Kessler presso Università degli Studi di Padova"
										infoHtml: "Concilio di Trento con Kessler...<br/><br/><img src=\"../images/imgPersonaggi/kesslerConcilio.jpg\" /><br/><br/>" + ReadMore,
									}
								},
								//linea temporale Kessler
								{
									start: "1924-02-17",
									end: "1976",
									polyline: [
										{ lat: 46.363603, lon: 10.672871 },
										{ lat: 45.417612, lon: 11.871836 },
										{ lat: 46.067827, lon: 11.121014 },
									],
									title: "Vita Kessler",
									options: {
										description: "Vita Kessler",
										theme: "blue",
										// any additional theme settings can go here
										lineWeight: 5
									}
								}
							]
						}
					}
				]
			});
			// set the map to our custom style
			var gmap = tm.getNativeMap();
			gmap.mapTypes.set("white", styledMapType);
			gmap.setMapTypeId("white");


			//gestione overlapping
			//!!!usare sempre getNativeMap che ritorna l' oggetto mappa!
			//con il secondo parametro faccio in mondo che lo spyderfly rimanga anche dopo il clik (devo cliccare sulla mappa per farlo scomparire)
			var oms = new OverlappingMarkerSpiderfier(gmap, { markersWontMove: true, keepSpiderfied: true });

			var gm = google.maps;

			oms.addListener('click', function (marker) {
				tm.getSelected().openInfoWindow();
			});
			oms.addListener('spiderfy', function (markers) {
				//tm.getSelected().closeInfoWindow();				
			});
			oms.addListener('unspiderfy', function (markers) {
				//tm.getSelected().closeInfoWindow();
			});
			//recupero il vettore di tutti gli item!!
			var a = tm.getItems();
			for (var i = 0; i < a.length; i++) {
				//devo prenderli dentro tutti!!!! con getNativePlacemark() recupero il marker di ogni Item della TimeMap!!!
				a[i].closeInfoWindow();
				oms.addMarker(a[i].getNativePlacemark());  // <-- here
			}
		});

		function CentroOverlay() {
			//imposto la finestra sempre in mezzo!!!
			var PosX = ($(window).width() - $("#box").width()) / 2;
			var percentualeX = PosX / $(window).width() * 100;
			//alert(percentualeX);
			$("#box").css({ "left": percentualeX + "%" });
		}

		//controllo se la finestra è stata ridimensionata con jquery
		jQuery(window).bind('resize', function () {
			CentroOverlay();
		});

		function ApriOverlay(a) {
			CentroOverlay();
			//riporto i 2 div nella posizione originale(all' inizio) ad ogni aperture dell' overlay
			jQuery("div.split_dx").animate({ scrollTop: 0 });
			jQuery("div.split_sx").animate({ scrollTop: 0 });
			//alert(tm.getSelected().getTitle());
			//!!!recupero info titolo con get selected e guardo il suo titolo per creare overlay dinamico
			$(".titolo_box").text(tm.getSelected().getTitle()); //assegno il titolo appena recuperato all' overlay
			$(".testo-box").text(tm.getSelected().getTitle());
			var split = tm.getSelected().getInfoHtml().split("/"); //come fare la split!!
			var nomeImmOverlay;
			//alert(a[0]);
			for (i = 0; i < split.length; i++) {
				if (split[i] == "imgPersonaggi") {
					var splitNome = split[i + 1].split(".");
					nomeImmOverlay = splitNome[0] + "_big" + ".jpg";
					break;
				}
			}
			//da notare che jQuery funziona come i css (#->id, .->classi)
			$("#img_overlay").attr("src", "../images/imgPersonaggi/" + nomeImmOverlay);

			//ora che ho modificato tutti i campi dinamicamente posso mostrare l' overlay
			$("#apri").click(
				function () {
					$('#overlay').fadeIn('fast');
					$('#box').fadeIn('slow');
				});
		}
		function CambioScalaTimelineGiorno() {
			tm.changeTimeIntervals(TimeMap.intervals.day);
		}
		function CambioScalaTimelineAnno() {
			tm.changeTimeIntervals(TimeMap.intervals.yr);
		}
		function CambioScalaTimelineMese() {
			tm.changeTimeIntervals(TimeMap.intervals.mon);
		}
		function CambioScalaTimelineDecade() {
			tm.changeTimeIntervals(TimeMap.intervals.dec);
		}
		function toggleDataset(dsid, toggle) {
			if (toggle) {
				tm.datasets[dsid].show();
			} else {
				tm.datasets[dsid].hide();
			}
		}
	</script>
	<link href="examples.css" type="text/css" rel="stylesheet" />
</head>

<body>

	<!--div necessari per l' overlay-->
	<div class="overlay" id="overlay" style="display: none;"></div>
	<!--contenuto overlay-->
	<div id="box">
			<div class="split_sx">
				<h1 class="titolo_box"></h1>
				<p class="testo-box"></p>
				<img id="img_overlay" class="testo-box" src="" />
<!--				<hr />-->
			</div>
			<div class="split_dx">
				<h3>Immagini del tempo</h3>
				<!--<p>Prova</p>-->
				<img src="../images/imgOverlay/1956_06Congr.jpg" />
				<br /><br />
				<img src="../images/imgOverlay/7145486.jpg" />
				<br /><br />
				<img src="../images/imgOverlay/955d_35.jpg" />
				<br /><br />
				<img src="../images/imgOverlay/inaugurazione.jpg" />				
			</div>
			<p class="chiudi">X</p>
	</div>
	<!--fine box-->


	<div id="help">
		<h1>Prova timeline</h1>
		<p class="lead">Prova timeline</p>

		<div class="navbar">
			<div class="navbar-inner">
				<ul class="nav">
					<li><a href="#" onclick="CambioScalaTimelineGiorno()">Giorno-Mese</a></li>
					<li><a href="#" onclick="CambioScalaTimelineMese()">Mese-Anno</a></li>
					<li><a href="#" onclick="CambioScalaTimelineAnno()">Anno-Decade</a></li>
					<li><a href="#" onclick="CambioScalaTimelineDecade()">Decade-Secolo</a></li>
				</ul>
			</div>
		</div>

		<p>
			Show:&nbsp;
			<span id="artbox">
				<input type="checkbox" onclick="toggleDataset('Fantozzi', this.checked);" checked="checked" />
				Fantozzi</span> &nbsp;&nbsp;&nbsp;
			<span id="authbox">
				<input type="checkbox" onclick="toggleDataset('Kessler', this.checked);" checked="checked" />
				Kessler</span>
		</p>
	</div>


	<div id="timemap">
		<div id="timelinecontainer">
			<div id="timeline"></div>
		</div>
		<div id="mapcontainer">
			<div id="map"></div>
		</div>
	</div>
</body>
</html>
